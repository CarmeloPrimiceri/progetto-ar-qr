<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esperienza AR con QR Code - Mondo degli Spiritelli</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

    <!-- AR.js con supporto per QR code -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <!-- Mixer per animazioni GLTF -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<!-- Overlay iniziale per avviare l'esperienza e l'audio -->
<div id="start-overlay" class="start-overlay">
    <div class="start-container">
        <h2>Il Mondo degli Spiritelli</h2>
        <p>Un'avventura in RealtÃ  Aumentata</p>
        <button id="startExperience" class="start-btn">Inizia Esperienza</button>
    </div>
</div>

<!-- Schermata di caricamento -->
<div class="loading-screen">
    <div class="spinner"></div>
    <div class="loading-text">Caricamento dell'esperienza AR...</div>
</div>

<!-- Istruzioni -->
<div class="instructions">
    Punta la fotocamera verso un QR code per iniziare l'avventura nel mondo degli spiritelli!
</div>

<!-- Container per il dialogo -->
<div class="dialog-container">
    <div class="dialog-text"></div>
    <div class="choices-container"></div>
</div>

<!-- Controlli audio -->
<div class="audio-controls">
    <button id="toggleAudio" class="audio-btn">
        <span id="audioIcon">ðŸ”Š</span>
    </button>
</div>

<!-- Scena AR -->
<a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3; codeBarMarkerDetection: true;"
        renderer="antialias: true; alpha: true; precision: mediump;"
        vr-mode-ui="enabled: false"
        loading-screen="enabled: false">

    <a-assets>
        <!-- Modelli 3D per i diversi spiritelli -->
        <a-asset-item id="spiritello-model" src="assets/models/Fiorellino.glb"></a-asset-item>

        <!-- Audio di sottofondo -->
        <audio id="background-music" src="assets/audio/background-music.mp3" preload="auto" loop></audio>
    </a-assets>

    <!-- EntitÃ  audio che riproduce la musica di sottofondo -->
    <a-entity sound="src: #background-music; autoplay: true; loop: true; volume: 0.5"></a-entity>

    <!-- QR Code Brochure - Introduzione -->
    <a-marker id="brochure" type="barcode" value="0" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Il modello 3D verrÃ  inserito dinamicamente tramite JavaScript -->
    </a-marker>

    <!-- QR Code Giallo - Spiritello con i pacchi -->
    <a-marker id="giallo" type="barcode" value="1" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Il modello 3D verrÃ  inserito dinamicamente tramite JavaScript -->
    </a-marker>

    <!-- QR Code Blu - Spiritello dell'acqua -->
    <a-marker id="blu" type="barcode" value="2" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Il modello 3D verrÃ  inserito dinamicamente tramite JavaScript -->
    </a-marker>

    <!-- QR Code Blu 2 - Continuazione tubo -->
    <a-marker id="blu2" type="barcode" value="3" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Il modello 3D verrÃ  inserito dinamicamente tramite JavaScript -->
    </a-marker>

    <!-- QR Code Blu 3 - Tubo chiuso -->
    <a-marker id="blu3" type="barcode" value="4" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Il modello 3D verrÃ  inserito dinamicamente tramite JavaScript -->
    </a-marker>

    <!-- QR Code Rosa - Spiritello dei fiori -->
    <a-marker id="rosa1" type="barcode" value="5" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Il modello 3D verrÃ  inserito dinamicamente tramite JavaScript -->
    </a-marker>

    <!-- QR Code Rosso - Spiritello cattivo -->
    <a-marker id="rosso" type="barcode" value="6" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Il modello 3D verrÃ  inserito dinamicamente tramite JavaScript -->
    </a-marker>

    <!-- QR Code Arcobaleno - Finale -->
    <a-marker id="arcobaleno" type="barcode" value="7" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
        <!-- Il modello 3D verrÃ  inserito dinamicamente tramite JavaScript -->
    </a-marker>

    <!-- Camera -->
    <a-entity camera></a-entity>
</a-scene>

<!-- JavaScript -->
<script src="js/dialog.js"></script>
<script src="js/main.js"></script>
<script src="js/camera.js"></script>

<div id="debug-info" style="position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; font-family: monospace; z-index: 9999; max-width: 50%;">
    Debug: Nessun marker rilevato
</div>

<script>
    // Script per mostrare informazioni di debug
    document.addEventListener('DOMContentLoaded', function() {
        const debugInfo = document.getElementById('debug-info');
        const markers = document.querySelectorAll('a-marker');

        markers.forEach(marker => {
            marker.addEventListener('markerFound', () => {
                debugInfo.textContent = `Debug: Marker "${marker.id}" trovato!`;
                debugInfo.style.backgroundColor = 'rgba(0,255,0,0.7)';
                setTimeout(() => {
                    debugInfo.style.backgroundColor = 'rgba(0,0,0,0.7)';
                }, 2000);
            });

            marker.addEventListener('markerLost', () => {
                debugInfo.textContent = 'Debug: Marker perso';
            });
        });
    });
</script>

</body>
</html>